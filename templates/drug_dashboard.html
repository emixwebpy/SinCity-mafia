{% extends "base.html" %}
{% block title %}Drug Market{% endblock %}
{% block content %}
<style>
.drug-dashboard-header {
    background: linear-gradient(90deg, #232526 0%, #414345 100%);
    padding: 2rem 2rem 1rem 2rem;
    border-radius: 12px 12px 0 0;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    margin-bottom: 0;
}
.drug-dashboard-header h2 {
    color: #ffd700;
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 0.5rem;
    letter-spacing: 2px;
    font-weight: 900;
}
.drug-dashboard-table {
    width: 100%;
    color: #f5f6fa;
    border-collapse: separate;
    border-spacing: 0 5px;
    margin-bottom: 12px;
}
.drug-dashboard-table th, .drug-dashboard-table td {
    padding: 1rem 1rem;
    text-align: left;
    vertical-align: middle;
}
.drug-dashboard-table th {
    background: #181824;
    color: #ffd700;
    font-size: 1.1rem;
    font-weight: bold;
    border-bottom: 2px solid #8be9fd55;
}
.drug-dashboard-table tr {
    background: #282a36;
    transition: background 0.2s;
}
.drug-dashboard-table tr:hover {
    background: #34355b;
}
.btn-primary {
    background: linear-gradient(90deg, #ffb347 0%, #ffd700 100%);
    color: #232526;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    font-weight: bold;
    margin-bottom: 0;
    transition: background 0.2s;
    text-decoration: none;
}
.btn-primary:hover {
    background: linear-gradient(90deg, #ffd700 0%, #ffb347 100%);
    color: #232526;
}
.btn-danger {
    background: #ff5555;
    color: #fff;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    font-weight: bold;
    transition: background 0.2s;
    text-decoration: none;
}
.btn-danger:hover {
    background: #ff2222;
    color: #fff;
}
</style>

<div class="drug-dashboard-header">
    <h2><i class="fas fa-capsules"></i> Drug Market in {{ character.city }}</h2>
</div>
<div class="drug-dashboard-container">
    <table class="drug-dashboard-table">
        <tr>
            <th style="width:20%;">Drug</th>
            <th style="width:15%;">Price</th>
            <th style="width:15%;">Stock</th>
            <th style="width:20%;">Buy</th>
            <th style="width:15%;">Your Qty</th>
            <th style="width:15%;">Sell</th>
        </tr>
        {% for drug in drugs %}
            {% set dealer = dealers.get(drug.id) %}
                {% set inv = inventory.get(drug.id) %}
                <tr>
                    <td>{{ drug.name }}</td>
                    <td>{% if dealer %}${{ dealer.price }}{% else %}N/A{% endif %}</td>
                    <td>{% if dealer %}{{ dealer.stock }}{% else %}N/A{% endif %}</td>
                    <td>
                        {% if dealer %}
                            <form method="post" style="display:inline;">
                                {{ buy_forms[drug.id].hidden_tag() }}
                                {{ buy_forms[drug.id].quantity(min=1, max=dealer.stock) }}
                                <button type="submit" class="btn btn-primary">
                                    {{ buy_forms[drug.id].submit(value="Buy") }}
                                </button>
                            </form>
                        {% endif %}
                    </td>
                    <td>{{ inv.quantity if inv else 0 }}</td>
                    <td>
                        {% if dealer and inv and inv.quantity > 0 %}
                            <form method="post" style="display:inline;">
                                {{ sell_forms[drug.id].hidden_tag() }}
                                {{ sell_forms[drug.id].quantity(min=1, max=inv.quantity) }}
                                <button type="submit" class="btn btn-danger">
                                    {{ sell_forms[drug.id].submit(value="Sell") }}
                                </button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% else %}
            <tr>
                <td colspan="6" style="color:#b8b8ff;">No drugs available.</td>
            </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}